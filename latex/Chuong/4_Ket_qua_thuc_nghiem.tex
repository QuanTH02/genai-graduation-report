\documentclass[../DoAn.tex]{subfiles}
\begin{document}

\section{Thiết kế kiến trúc}
\subsection{Lựa chọn kiến trúc phần mềm}
Trong sản phẩm này, tôi lựa chọn kiến trúc phần mềm MVT trong Django \cite{DjangoMVT}.

\textbf{Giải thích sơ bộ về MVT:}

Kiến trúc MVT của Django tương tự như kiến trúc MVC (Model-View-Controller), nhưng có sự khác biệt về cách hoạt động.

\begin{itemize}
    \item \textbf{Model (M):} Định nghĩa cấu trúc dữ liệu của ứng dụng và quản lý truy cập vào cơ sở dữ liệu.
    \item \textbf{View (V):} Xử lý logic xử lý nghiệp vụ và hiển thị dữ liệu cho người dùng.
    \item \textbf{Template (T):} Định nghĩa giao diện người dùng bằng cách sử dụng HTML cùng với các biến Python.
\end{itemize}

\textbf{Mô tả kiến trúc cụ thể cho ứng dụng:}

\begin{itemize}
    \item \textbf{Model (M):} 
    
Trong ứng dụng của em, các model như MovieInformation, Awards, Director, Cast, Genres, và các model liên quan khác sẽ đại diện cho các đối tượng dữ liệu chính về phim, đạo diễn, diễn viên, thể loại.

Mỗi model sẽ có các trường (fields) tương ứng và quan hệ (relationships) với các model khác để lưu trữ và quản lý thông tin một cách logic và cấu trúc hóa.
    
    \item \textbf{View (V):} 

Các view như FilmListView, DirectorListView, GenreListView, ReviewView, và các view khác trong danh sách của tôi sẽ đảm nhiệm xử lý các yêu cầu từ người dùng.

View sẽ truy xuất dữ liệu từ model thông qua các queryset, xử lý logic nghiệp vụ và chuẩn bị dữ liệu để truyền cho template.

    \item \textbf{Template (T):} 

Sử dụng các template HTML của Django kết hợp với template tags hiển thị dữ liệu cho người dùng.

Template sẽ nhận dữ liệu từ view và render ra các thành phần giao diện như danh sách phim, thông tin chi tiết, biểu đồ.

\end{itemize}

\subsection{Thiết kế tổng quan}
\textbf{Các gói và sự phụ thuộc giữa các gói: }

\begin{figure}[H]
    \centering
    \includegraphics[width=1\linewidth]{Hinhve/imgUML.png}
    \caption{Biểu đồ phụ thuộc gói}
    \label{fig:imgUML}
\end{figure}

\begin{enumerate}
    \item Data Access Layer (Model)

    \begin{itemize}
        \item Mục đích: Tầng này chịu trách nhiệm chứa các định nghĩa về dữ liệu và cấu trúc dữ liệu của hệ thống.
    
        \item Nhiệm vụ: Thực hiện mô hình hóa các thực thể trong ứng dụng, bao gồm việc định nghĩa các bảng cơ sở dữ liệu và các mối quan hệ giữa các bảng đó.
        
        \item Các thành phần: MovieInformation, Awards, Director, Cast, Genres.
        
        \item Phụ thuộc: Tầng này không có sự phụ thuộc vào bất kỳ gói nào khác. Đây là tầng nằm ở mức thấp nhất trong kiến trúc hệ thống, nơi các dữ liệu được định nghĩa và quản lý thông qua các model.
    \end{itemize}

    \item Business Logic Layer (View)

    \begin{itemize}
        \item Mục đích: Tầng này đảm nhiệm việc xử lý logic nghiệp vụ và quản lý các yêu cầu đến từ phía người dùng.
        
        \item Nhiệm vụ: Thực hiện truy xuất dữ liệu từ các model, tiến hành xử lý và chuẩn bị dữ liệu để có thể hiển thị trong template.
        
        \item Các thành phần: FilmListView, DirectorListView, GenreListView, ReviewView.
        
        \item Phụ thuộc: Tầng này có sự phụ thuộc vào gói Models. View sẽ thực hiện truy xuất dữ liệu từ model và xử lý logic nghiệp vụ, không có sự phụ thuộc trực tiếp vào gói Templates. Dữ liệu sau khi được chuẩn bị trong view sẽ được chuyển đến template để hiển thị cho người dùng.
    \end{itemize}

    \item Presentation Layer (Template)

    \begin{itemize}
        \item Mục đích: Tầng này chịu trách nhiệm định nghĩa và xây dựng giao diện người dùng.
        
        \item Nhiệm vụ: Thực hiện hiển thị dữ liệu được truyền từ view dưới các định dạng HTML, CSS và JavaScript. Template sẽ tiếp nhận dữ liệu từ view và thực hiện việc hiển thị dữ liệu đó.
        
        \item Các thành phần: Các tệp HTML template được sử dụng cho các trang web khác nhau của ứng dụng, chẳng hạn như trang đăng nhập, đăng ký, trang chủ, trang chi tiết phim.
        
        \item Phụ thuộc: Tầng này có sự phụ thuộc vào gói Views. Templates tiếp nhận dữ liệu từ view và thực hiện hiển thị, không có sự phụ thuộc trực tiếp vào gói Models. Tất cả dữ liệu được hiển thị trên giao diện đều được truyền từ view.
    \end{itemize}

\end{enumerate}

\subsection{Thiết kế chi tiết gói}

\begin{figure}[H]
    \centering
    \includegraphics{Hinhve/layerModel.png}
    \caption{Thiết kế chi tiết gói ở tầng Model}
    \label{fig:layerModel}
\end{figure}

\textbf{Gói Model:}

Ở gói này, có các gói nhỏ hợp thành là User và Movie. 

\begin{itemize}
    \item \textbf{Gói User:} 
    Gồm 3 class l là Review, User và LikeMovie. 

    Mô tả: Class User: Đại diện cho thông tin người dùng. Class Review: Chứa thông tin về đánh giá phim của người dùng. Class LikeMovie: Lưu trữ những bộ phim mà người dùng thích.
    
    Phụ thuộc: Class Review và class LikeMovie phụ thuộc vào thông tin của User. 
    
    \item  \textbf{Gói Movie:} 
    
    Gồm 5 class là Movieinfomation, Director, Award, Cast, Writer. 

    Mô tả: Class MovieInformation: Lớp chính quản lý thông tin tổng quát về phim. Class Director: Lưu trữ thông tin chi tiết về các đạo diễn của phim. Class Award: Lưu trữ thông tin về các giải thưởng phim đã nhận được. Class Cast: Lưu trữ thông tin về các diễn viên tham gia trong phim. Class Writer: Lưu trữ thông tin về các nhà biên kịch của phim.

    Phụ thuộc: 4 class còn lại có quan hệ phụ thuộc với Movieinfomation, lấy Movieinfomation làm gốc, các thông tin còn lại đều là thông tin bổ sung.
\end{itemize}

\begin{figure}[H]
    \centering
    \includegraphics{Hinhve/layerView.png}
    \caption{Thiết kế chi tiết gói ở tầng View}
    \label{fig:layerView}
\end{figure}

\textbf{Gói View:}

Ở gói này, có các gói nhỏ hợp thành là UserView, MovieView và AdminView.

\begin{itemize}
    \item Gói UserView:

    Gồm 3 class l là ReviewView, UserView và LikeMovieView. 

    Mô tả: Class UserView: Lớp này chịu trách nhiệm hiển thị và xử lý các thông tin liên quan đến người dùng, bao gồm đăng ký, đăng nhập, và thông tin cá nhân. Class ReviewView: Lớp này xử lý và hiển thị các đánh giá phim của người dùng. Nó phụ thuộc vào thông tin người dùng từ UserView. Class LikeMovieView: Lớp này quản lý và hiển thị các bộ phim mà người dùng đã thích. Nó cũng phụ thuộc vào thông tin người dùng từ UserView.
    
    Phụ thuộc: Class ReviewView và class LikeMovieView phụ thuộc vào thông tin của UserView. 

    \item  Gói MovieView: 
    
    Gồm 5 class là MovieinfomationView, DirectorView, AwardView, CastView, WriterView. 

    Mô tả: Class MovieInformationView: Lớp chính quản lý, thao tác chính về phim. Class DirectorView: Xử lý dữ liệu về đạo diễn. Class AwardView: Xử lý dữ liệu, các thao tác về giải thưởng. Class CastView: Xử lý dữ liệu, các thao tác tính về diễn viên. Class Writer: Thao tác dữ liệu với biên kịch.

    Phụ thuộc: 4 class còn lại có quan hệ phụ thuộc với Movieinfomation, lấy Movieinfomation làm gốc, các thông tin còn lại đều là thông tin bổ sung.

    \item  Gói AdminView: 
    
    Gồm 1 class là AdminView. 

    Mô tả: Class AdminView có thể xử lý toàn bộ yêu cầu bao gồm các yêu cầu giống người dùng và có thể khác, admin quản lý toàn bộ trang web. Có thể thêm, sửa, xóa toàn bộ dữ liệu.

    Phụ thuộc: Không phụ thuộc vào class nào.
\end{itemize}

\begin{figure}[H]
    \centering
    \includegraphics[width=1\linewidth]{Hinhve/layerTemp.png}
    \caption{Thiết kế chi tiết gói ở tầng Template}
    \label{fig:layerTemp}
\end{figure}

\textbf{Gói Template:}

Gói này bao gồm hai thành phần chính là UserTemplate và AdminTemplate.

Về chức năng, lớp UserTemplate đảm nhận việc quản lý hệ thống các tệp HTML giao diện dành riêng cho người dùng cuối, bao gồm các trang chức năng như đăng nhập, đăng ký, hồ sơ cá nhân, khu vực đánh giá phim, cùng các danh mục hiển thị về phim ảnh, diễn viên và đạo diễn. Trong khi đó, lớp AdminTemplate tập trung vào việc quản lý các giao diện dành cho nhà quản trị, hỗ trợ các nghiệp vụ điều hành hệ thống như kiểm soát tài khoản người dùng, cập nhật dữ liệu phim, kiểm duyệt bình luận và các công cụ quản lý tổng thể khác.

Về tính liên kết, hai lớp này được thiết kế hoàn toàn độc lập và không có quan hệ phụ thuộc lẫn nhau. Mỗi lớp vận hành tự chủ nhằm đáp ứng các mục tiêu chuyên biệt: một bên tối ưu hóa trải nghiệm cho khách hàng và một bên cung cấp công cụ vận hành cho bộ phận quản trị.

\section{Thiết kế chi tiết}
\subsection{Thiết kế giao diện}
Khi tiến hành thiết kế giao diện cho hệ thống, tôi đã chọn lựa các tham số kỹ thuật, các tiêu chuẩn thiết kế và các mẫu template chuẩn để đảm bảo sự đồng nhất và tính tiện dụng. Những màn hình chính của hệ thống được xây dựng với độ phân giải 1920x1080 pixels, tương thích với các loại màn hình có kích thước từ 13 inch trở lên. Hệ thống có khả năng hiển thị lên đến 16 triệu màu để đảm bảo các thành phần đồ họa và hình ảnh hiển thị với chất lượng cao và chi tiết.

Trong giai đoạn thiết kế, tôi đã áp dụng các nguyên tắc thiết kế cụ thể để xây dựng một giao diện có sự thống nhất. Những nút điều khiển được xây dựng với kích thước tuân theo các tiêu chuẩn phổ biến, giúp người dùng có thể dễ dàng nhận diện và thực hiện các thao tác. Các thành phần điều khiển như menu thả xuống, hộp kiểm và nút radio được xây dựng để có diện mạo thống nhất, nhất quán và dễ phân biệt. Những thông báo phản hồi cho người dùng được đặt ở vị trí dễ nhìn thấy, cụ thể là góc trên bên phải màn hình.

Đối với việc chọn lựa màu sắc, tôi đã chọn một bảng màu cơ bản với hai tông màu chủ đạo là đen và tím, mang lại cảm giác thoải mái và thể hiện tính chuyên nghiệp. Những màu bổ sung được dùng để nhấn mạnh các thành phần quan trọng hoặc để báo hiệu các trạng thái khác nhau như thành công, cảnh báo, lỗi và trạng thái khi di chuột qua với các màu đỏ, vàng và xanh lá.

Sau đây là các hình ảnh trực quan mô phỏng thiết kế giao diện cho những tính năng trọng tâm của ứng dụng:

\textbf{Màn hình đăng nhập}
\begin{figure}[H]
    \centering
    \includegraphics[width=1\linewidth]{Hinhve/web_login.png}
    \caption[Màn hình \textit{đăng nhập}]{Màn hình \textit{đăng nhập}}
    \label{fig:web_login}
\end{figure}

\textbf{Màn hình đăng ký}
\begin{figure}[H]
    \centering
    \includegraphics[width=1\linewidth]{Hinhve/web_signup.png}
    \caption[Màn hình \textit{đăng ký}]{Màn hình \textit{đăng ký}}
    \label{fig:web_signup}
\end{figure}

\textbf{Màn hình profile}
\begin{figure}[H]
    \centering
    \includegraphics[width=1\linewidth]{Hinhve/web_profile.png}
    \caption[Màn hình \textit{profile}]{Màn hình \textit{profile}}
    \label{fig:web_profile}
\end{figure}

\textbf{Màn hình chính}
\begin{figure}[H]
    \centering
    \includegraphics[width=1\linewidth]{Hinhve/web_home.png}
    \caption[Màn hình \textit{chính}]{Màn hình \textit{chính}}
    \label{fig:web_home}
\end{figure}

\textbf{Màn hình gợi ý phim ở trang chủ}
\begin{figure}[H]
    \centering
    \includegraphics[width=1\linewidth]{Hinhve/web_recommend.png}
    \caption[Màn hình \textit{gợi ý phim ở trang chủ}]{Màn hình \textit{gợi ý phim ở trang chủ}}
    \label{fig:web_recommend}
\end{figure}

\textbf{Màn hình thông tin chi tiết}
\begin{figure}[H]
    \centering
    \includegraphics[width=1\linewidth]{Hinhve/web_detail.png}
    \caption[Màn hình \textit{thông tin chi tiết 1}]{Màn hình \textit{thông tin chi tiết 1}}
    \label{fig:web_detail}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=1\linewidth]{Hinhve/web_detail1.png}
    \caption[Màn hình \textit{thông tin chi tiết 2}]{Màn hình \textit{thông tin chi tiết 2}}
    \label{fig:web_detail1}
\end{figure}

\textbf{Màn hình tổng hợp đạo diễn, diễn viên, ...}
\begin{figure}[H]
    \centering
    \includegraphics[width=1\linewidth]{Hinhve/web_cast_and_crew.png}
    \caption[Màn hình \textit{tổng hợp đạo diễn, diễn viên, ...}]{Màn hình \textit{tổng hợp đạo diễn, diễn viên, ...}}
    \label{fig:web_cast_and_crew}
\end{figure}

\textbf{Màn hình review phim}
\begin{figure}[H]
    \centering
    \includegraphics[width=1\linewidth]{Hinhve/web_user_review.png}
    \caption[Màn hình \textit{review phim}]{Màn hình \textit{review phim}}
    \label{fig:web_user_review}
\end{figure}

\subsection{Thiết kế cơ sở dữ liệu}
\begin{figure}[H]
\centering
\includegraphics[width=1\linewidth]{Hinhve/ERD.jpg}
\caption{Sơ đồ ERD}
\label{fig:Ket_qua}
\end{figure} 

\begin{figure}[H]
\centering
\includegraphics[width=0.3\linewidth]{Hinhve/data1.png}
\caption{Hình ảnh các table trong database 1}
\label{fig:Database1}
\end{figure} 

\begin{figure}[H]
\centering
\includegraphics[width=0.3\linewidth]{Hinhve/data2.png}
\caption{Hình ảnh các table trong database 2}
\label{fig:Database2}
\end{figure} 

\begin{figure}[H]
\centering
\includegraphics[width=0.3\linewidth]{Hinhve/data3.png}
\caption{Hình ảnh các table trong database 3}
\label{fig:Database3}
\end{figure} 

\subsection{Thiết kế hệ thống crawl dữ liệu}
\textbf{IMDb:} Ở trang web này, tôi chia ra các thông tin để crawl như sau:

% \begin{tabular}{|c|c|} 
%  \hline
%  \textbf{Page} & \textbf{Thông tin cần lấy} \\ \hline
%  Home & Các thông tin cơ bản của một bộ phim như: Tên phim, ngày tháng năm sản xuất, mô tả, thời lượng, ... \\ \hline
%  Award & Giải thưởng của phim \\ \hline
%  Director & Đạo diễn \\ \hline
%  Cast & Các diễn viên nổi tiếng và các diễn viên khác \\ \hline
%  Storyline & Cốt truyện, thể loại \\ \hline
%  Rating & Danh sách, số lượng đánh giá của người dùng \\ \hline
%  Review & Các đánh giá phim của người dùng khác \\ \hline
% \end{tabular}

\begin{table}[H]
\centering
\caption{Tổng hợp các thông tin cần lấy}
\includegraphics[width=1\linewidth]{Hinhve/tb_crawl.png}
\label{tab:tb_crawl}
\end{table} 

\textbf{BoxofficeMojo:} Ở trang web này, tôi sẽ tìm các bộ phim có trong BoxofficeMojo bằng cách lấy khóa chính là movie name có trong IMDb, sau đó sẽ lấy các thông tin về doanh thu và update vào data.

\subsection{Tìm kiếm phim bằng ngôn ngữ tự nhiên}
Ứng dụng hỗ trợ tìm kiếm phim bằng câu tự nhiên (natural language search), cho phép người dùng nhập yêu cầu tìm kiếm bằng ngôn ngữ thông thường thay vì phải sử dụng các từ khóa cụ thể. Tính năng này kết hợp hai phương pháp tìm kiếm: Vector Search (semantic search) và AI Filter (structured search) để đảm bảo độ chính xác và toàn diện trong kết quả tìm kiếm.

\subsubsection{Tổng quan luồng xử lý}

\begin{figure}[H]
    \centering
    \includegraphics[width=1\linewidth]{Hinhve/web_search.png}
    \caption[Màn hình \textit{tìm kiếm phim}]{Màn hình \textit{tìm kiếm phim}}
    \label{fig:web_search}
\end{figure}

Khi người dùng nhập câu tìm kiếm, ứng dụng sẽ xử lý theo các bước sau:

\begin{itemize}
    \item Frontend gửi yêu cầu: Component React sẽ gửi câu tìm kiếm đến API endpoint.
    \item Backend xử lý song song: Ứng dụng thực hiện đồng thời hai phương pháp tìm kiếm:
    \begin{itemize}
        \item Vector Search: Tìm kiếm theo ngữ nghĩa (semantic) dựa trên embedding
        \item AI Filter: Tìm kiếm có cấu trúc (structured) dựa trên các thuộc tính cụ thể
    \end{itemize}
    \item Kết hợp kết quả: Ứng dụng hợp nhất và sắp xếp kết quả từ hai phương pháp theo độ ưu tiên
    \item Trả về kết quả: Gửi danh sách phim kèm thông tin phân trang về frontend
\end{itemize}

\subsubsection{Các thành phần kỹ thuật}

Frontend: Frontend nhận sự kiện click button tìm kiếm và gửi yêu cầu đến API endpoint.

Backend API Endpoint: Backend kiểm tra tính hợp lệ của query, xử lý yêu cầu tìm kiếm. Xử lý phân trang và điều phối hai phương pháp tìm kiếm song song.

Vector Search (Semantic Search):

Thực hiện tìm kiếm theo ngữ nghĩa:

\begin{itemize}
    \item Tạo embedding vector từ câu query bằng mô hình Gemini.
    \item Tải embeddings của các bộ phim đã được tính toán trước.
    \item Tính cosine similarity giữa embedding của query và embedding của mỗi phim
    \item Chọn top 200 kết quả có độ tương đồng cao nhất
\end{itemize}

Embedding của phim được tạo bởi kết hợp các thông tin: tên phim, năm sản xuất, mô tả, storyline, thể loại, đạo diễn, và diễn viên.

\textbf{AI Filter (Structured Search):}

Phân tích câu query bằng AI:

\begin{itemize}
    \item Gửi câu query đến mô hình Gemini.
    \item AI trích xuất các thông tin có cấu trúc từ câu query thành định dạng JSON, bao gồm:
    \begin{itemize}
        \item movie\_name: Tên phim

        \item year\_min/year\_max: Khoảng năm sản xuất
        \item rating\_min/rating\_max: Khoảng đánh giá
        \item genres: Danh sách thể loại
        \item directors: Danh sách đạo diễn
        \item cast: Danh sách diễn viên
        \item countries: Danh sách quốc gia
        \item languages: Danh sách ngôn ngữ
        \item keywords: Các từ khóa khác
    \end{itemize}
    \item Cuối cùng là thực hiện lọc phim dựa trên các tiêu chí được AI trích xuất
\end{itemize}

\subsubsection{Chiến lược kết hợp kết quả}

Ứng dụng hợp nhất kết quả từ hai phương pháp tìm kiếm theo ba mức độ ưu tiên:

\begin{itemize}
    \item Ưu tiên cao: Các phim xuất hiện trong cả Vector Search và AI Filter - được sắp xếp theo độ tương đồng (similarity) từ cao xuống thấp
    \item Ưu tiên trung: Các phim chỉ xuất hiện trong Vector Search - tối đa 50 kết quả
    \item Ưu tiên thấp: Các phim chỉ xuất hiện trong AI Filter - tối đa 50 kết quả
\end{itemize}

Chiến lược này đảm bảo kết quả vừa phù hợp về mặt ngữ nghĩa, vừa đáp ứng các tiêu chí cụ thể mà người dùng yêu cầu.

\subsubsection{Xử lý sau tìm kiếm}

Sau khi có danh sách phim kết quả, ứng dụng thực hiện các bước xử lý sau:

\begin{itemize}
    \item Serialize dữ liệu: Chuyển đổi đối tượng phim sang định dạng JSON để trả về cho frontend
    \item Lưu lịch sử tìm kiếm: Nếu người dùng đã đăng nhập, thì hệ thống sẽ lưu lại lịch sử tìm kiếm với định dạng JSON để phục vụ cho ứng dụng gợi ý phim trong tương lai
\end{itemize}

\subsubsection{Kết quả trả về}

API trả về response với cấu trúc:

\begin{itemize}
    \item data: Danh sách phim đã được sắp xếp và lọc
    \item pagination: Thông tin phân trang (số trang hiện tại, tổng số trang, tổng số kết quả)
    \item filter\_data: Thông tin các bộ lọc mà AI đã phân tích từ câu query, giúp người dùng hiểu rõ h
\end{itemize}

\subsubsection{Điểm mạnh của ứng dụng}

Tính năng tìm kiếm bằng ngôn ngữ người dùng có các ưu điểm sau:

\begin{itemize}
    \item Kết hợp hai phương pháp: Sự kết hợp giữa semantic search và structured search giúp cải thiện đáng kể độ chính xác của kết quả tìm kiếm
    \item Hỗ trợ đa ngôn ngữ: Thông qua mô hình Gemini, ứng dụng có thể xử lý câu tìm kiếm bằng nhiều ngôn ngữ khác nhau
    \item Lưu lịch sử: Ứng dụng tự động lưu lịch sử tìm kiếm của người dùng đã đăng nhập, hỗ trợ cho các tính năng gợi ý và phân tích hành vi
    \item Tối ưu hiệu suất: Embeddings được tính toán trước và lưu trong file pickle, giúp giảm thời gian xử lý khi tìm kiếm
\end{itemize}


\subsection{Gợi ý phim bằng genAI dựa vào lịch sử hoạt động của người dùng}
Ứng dụng sử dụng GenAI (Gemini hoặc OpenAI) để phân tích lịch sử hoạt động của người dùng và đưa ra gợi ý phim cá nhân hóa theo thời gian thực. Khác với các phương pháp gợi ý truyền thống yêu cầu training model, hệ thống này hoạt động real-time dựa trên dữ liệu lịch sử của từng người dùng, không cần retrain hay cập nhật model.

\subsubsection{Tổng quan luồng xử lý}

\begin{figure}[H]
    \centering
    \includegraphics[width=1\linewidth]{Hinhve/web_recommend.png}
    \caption[Màn hình \textit{gợi ý phim bằng genAI}]{Màn hình \textit{gợi ý phim bằng genAI}}
    \label{fig:web_recommend}
\end{figure}

Khi người dùng yêu cầu gợi ý phim, ứng dụng sẽ xử lý theo các bước sau:

\begin{itemize}
    \item Thu thập lịch sử người dùng: Ứng dụng lấy lịch sử tìm kiếm và lịch sử đánh giá của người dùng
    \item Xây dựng prompt cho GenAI: Ứng dụng tạo prompt chứa thông tin lịch sử và yêu cầu AI phân tích sở thích
    \item Gọi GenAI API: Ứng dụng gửi prompt đến GenAI (ưu tiên Gemini, fallback OpenAI) để nhận danh sách phim được gợi ý
    \item Tìm phim trong database: Ứng dụng tìm các phim được AI gợi ý trong database
    \item Trả về kết quả: Gửi danh sách phim đã được gợi ý về frontend
\end{itemize}

\subsubsection{Các thành phần kỹ thuật}

\textbf{Frontend:} Frontend gửi yêu cầu gợi ý phim đến API endpoint và hiển thị kết quả trả về.

\textbf{Backend API Endpoint:} Backend xử lý yêu cầu, thu thập lịch sử người dùng và gọi GenAI để tạo gợi ý.

\textbf{Thu thập lịch sử hoạt động:}

Ứng dụng thu thập ba loại dữ liệu lịch sử:

\begin{itemize}
    \item Lịch sử tìm kiếm: Tự động lưu lại các câu tìm kiếm của người dùng, bao gồm cả tìm kiếm thường và tìm kiếm ngôn ngữ tự nhiên. Ứng dụng lấy tối đa 20 query gần nhất để phân tích
    \item Lịch sử đánh giá: Lưu trữ các review phim của người dùng, bao gồm điểm đánh giá (1-5 sao), tiêu đề và nội dung review. Ứng dụng lấy tối đa 20 review gần nhất, ưu tiên các review có rating cao (4-5 sao)
    \item Theo dõi hoạt động: Ghi nhận các hành động của người dùng như xem chi tiết phim, click vào card phim, xem trailer, hoặc click vào kết quả tìm kiếm. Mỗi loại hoạt động có mức độ quan trọng khác nhau
\end{itemize}

\textbf{Xây dựng prompt cho GenAI:}

Ứng dụng tạo prompt chứa:

\begin{itemize}
    \item Lịch sử tìm kiếm: Liệt kê các câu tìm kiếm gần nhất của người dùng
    \item Lịch sử đánh giá: Liệt kê các phim đã được người dùng đánh giá kèm điểm số và tiêu đề review
    \item Yêu cầu phân tích: Genres người dùng tìm kiếm, themes và keywords, phim được đánh giá tích cực (4-5 sao), phim tương tự những gì đã review, xu hướng trong pattern tìm kiếm
    \item Yêu cầu trả về: Danh sách tên các phim được gợi ý dưới dạng JSON array
\end{itemize}

\textbf{Gọi GenAI API:}

Ứng dụng ưu tiên sử dụng Gemini API để phân tích lịch sử và đưa ra gợi ý. Nếu Gemini không khả dụng, ứng dụng sẽ fallback sang OpenAI API để đảm bảo tính khả dụng của hệ thống.

Xử lý response từ GenAI:
\begin{itemize}
    \item Parse JSON từ response (loại bỏ markdown code blocks nếu có)
    \item Validate format (phải là array chứa tên phim)
    \item Giới hạn số lượng phim theo yêu cầu
\end{itemize}

\textbf{Tìm phim trong database:}

Với mỗi tên phim được AI gợi ý, ứng dụng tìm phim tương ứng trong database:
\begin{itemize}
    \item Nếu phim không tìm thấy: Bỏ qua phim đó
    \item Chỉ trả về danh sách phim hợp lệ có trong database
\end{itemize}

\subsubsection{Kết quả trả về}

API trả về response với cấu trúc:
\begin{itemize}
    \item message: Thông báo trạng thái
    \item data: Danh sách phim đã được gợi ý dưới dạng JSON array
\end{itemize}


\section{Xây dựng ứng dụng}
\subsection{Thư viện và công cụ sử dụng}
Sau đây là các công cụ, ngôn ngữ lập trình, API, thư viện, IDE, công cụ kiểm thử mà tôi sử dụng để phát triển ứng dụng này.

\begin{table}[H]
\centering{}
\caption{Danh sách thư viện và công cụ sử dụng}
    \begin{tabular}{lll}
        \hline
        \textbf{Mục đích} & \textbf{Công cụ} & \textbf{Tài liệu tham khảo}    \\ \hline
        IDE lập trình & Visual Studio Code (VSCode) & \cite{VSCode} \\ \hline
API Framework & Django Rest Framework & \cite{DRF} \\ \hline
Frontend & HTML & \cite{HTML} \\ \hline
Style & Tailwind CSS & \cite{TailwindCSS} \\ \hline
Frontend Framework & React & \cite{React} \\ \hline
Backend Framework & Django & \cite{Django} \\ \hline
Database & MySQL & \cite{MySQL} \\ \hline
Công cụ crawl dữ liệu & Selenium & \cite{Selenium} \\ \hline
Thư viện HTTP & Requests & \cite{Requests} \\ \hline
Công cụ CI/CD & GitHub Actions & \cite{GitHubActions} \\ \hline
        \end{tabular}
    \label{fig:my_label}
\end{table}

% \begin{figure}[H]
% \centering
% \includegraphics[width=1\linewidth]{Hinhve/congnghe.png}
% \caption{Danh sách thư viện và công cụ sử dụng}
% \label{fig:congnghe}
% \end{figure}

\subsection{Kết quả đạt được}
\textbf{Mô tả kết quả đạt được:}
Sau khi hoàn thành quá trình phát triển, hệ thống Django đã được xây dựng với các sản phẩm được đóng gói như sau:

Gói Model: Bao gồm các mô hình dữ liệu phục vụ việc quản lý thông tin về phim, người dùng, và đánh giá.

Gói View: Bao gồm các class đảm nhiệm việc hiển thị và xử lý giao diện cho cả người dùng và quản trị viên.

Gói Template: Bao gồm các template HTML được sử dụng cho giao diện người dùng và giao diện quản trị.

Các sản phẩm được đóng gói đóng vai trò và có ý nghĩa quan trọng trong việc quản lý và hiển thị thông tin về phim, đạo diễn, diễn viên, và đánh giá phim. Hệ thống này cung cấp một nền tảng cho phép người dùng có thể thực hiện tìm kiếm và xem thông tin về các bộ phim, viết đánh giá, và tương tác với nội dung. Bên cạnh đó, hệ thống còn có khả năng đề xuất những bộ phim phù hợp nhất với từng hành động của người dùng thông qua hệ thống gợi ý.

\textbf{Thống kê các thông tin của ứng dụng:}

Quy mô mã nguồn thu thập dữ liệu: 2000 dòng

Quy mô mã nguồn phía backend: 4000 dòng

Quy mô mã nguồn phía frontend: 8000 dòng

Số lượng lớp: 180 lớp

Số lượng gói: 8 gói

Kích thước toàn bộ mã nguồn: Đạt mức 310MB khi tích hợp đầy đủ dữ liệu và thuật toán gợi ý, trong khi phần mã nguồn thuần túy chiếm khoảng 25MB

Nền tảng đã được kiện toàn với cấu trúc phân tầng rành mạch, đảm bảo sự khoa học trong việc phân chia giữa các gói và các lớp mã nguồn. Những số liệu thống kê về khối lượng mã và cấu trúc hệ thống là cơ sở quan trọng để đánh giá cũng như kiểm soát quá trình phát triển dự án. Hiện tại, hệ thống đã đáp ứng đầy đủ các tiêu chuẩn đề ra và hoàn toàn sẵn sàng cho việc vận hành trong môi trường thực tế.

\textbf{Crawl dữ liệu từ trang web:}

Nguồn dữ liệu: IMDb, BoxOfficeMojo

Số bộ phim đã crawl: 5000 bộ phim

Số ảnh đã crawl: 250000 ảnh

Số video đã crawl: 5000 video

\textbf{Tìm kiếm phim theo ngôn ngữ người dùng:}

Ở chức năng này, người dùng có thể tìm kiếm phim theo ngôn ngữ của mình. Ứng dụng sẽ nhận đầu vào, phân tích, embed text vào model để tìm kiếm phim theo ngôn ngữ của người dùng và đưa ra kết quả phù hợp.

\begin{figure}[H]
\centering
\includegraphics[width=1\linewidth]{Hinhve/search_phim.png}
\caption{Chức năng tìm kiếm phim theo ngôn ngữ người dùng}
\label{fig:search_phim}
\end{figure} 

Dựa vào hình ảnh kết quả trên, có thể thấy hệ thống đã đưa ra kết quả phù hợp với yêu cầu của người dùng. Ở trên là các phim marvel hệ thống đã đưa ra kết quả.

\textbf{Gợi ý phim theo lịch sử hoạt động của người dùng:}

Ở chức năng này, hệ thống sẽ gợi ý phim dựa vào lịch sử hoạt động của người dùng. Hệ thống sẽ theo dõi lịch sử hoạt động của người dùng như review phim, tìm kiếm phim, xem chi tiết phim, ... và đưa ra gợi ý các bộ phim tương tự với lịch sử hoạt động của người dùng.

\begin{figure}[H]
\centering
\includegraphics[width=1\linewidth]{Hinhve/review_phim.png}
\caption{Review phim}
\label{fig:review_phim}
\end{figure} 

\begin{figure}[H]
\centering
\includegraphics[width=1\linewidth]{Hinhve/goi_y_theo_review.png}
\caption{Gợi ý phim theo lịch sử review}
\label{fig:goi_y_theo_review}
\end{figure} 

Dựa vào lịch sử review của người dùng, hệ thống có thể tự học và đưa ra được kết quả mới nhất phù hợp với sở thích của người dùng. Ở phần trên, review phim người dùng bảo thích phim Iron Man, hệ thống đã đưa ra gợi ý phim tương tự là Iron man 1, 2, 3 và các bộ phim Marvel liên quan.

\begin{figure}[H]
\centering
\includegraphics[width=1\linewidth]{Hinhve/search_phim.png}
\caption{Tìm kiếm phim}
\label{fig:search_phim2}
\end{figure} 

\begin{figure}[H]
\centering
\includegraphics[width=1\linewidth]{Hinhve/goi_y_theo_search.png}
\caption{Gợi ý phim theo lịch sử tìm kiếm}
\label{fig:goi_y_theo_search}
\end{figure} 

Dựa vào lịch sử tìm kiếm của người dùng, hệ thống lưu lại lịch sử và đưa ra được kết quả mới nhất phù hợp với yêu cầu của người dùng. Ở phần trên, người dùng tìm kiếm phim Marvel, thì sau khi ra màn Home, hệ thống đã đưa ra gợi ý các phim Marvel liên quan.

\subsection{Minh họa các chức năng chính}
\textbf{Chức năng gợi ý phim dựa vào lịch sử thao tác của người dùng}
\begin{figure}[H]
\centering
\includegraphics[width=1\linewidth]{Hinhve/ketqua1.png}
\caption{Chức năng gợi ý phim dựa vào lịch sử thao tác của người dùng}
\label{fig:ketqua1}
\end{figure} 

Bằng cách nghiên cứu lịch sử lưu trữ phim của từng cá nhân, hệ thống có thể tự động cập nhật xu hướng và đưa ra những gợi ý mới nhất sát với gu thưởng thức riêng biệt của mỗi người dùng.

\textbf{Chức năng gợi ý phim dựa vào nội dung phim đang xem}
\begin{figure}[H]
\centering
\includegraphics[width=1\linewidth]{Hinhve/ketqua2.png}
\caption{Chức năng gợi ý phim dựa vào nội dung phim đang xem}
\label{fig:ketqua2}
\end{figure} 

Hệ thống cho phép hiển thị các tác phẩm điện ảnh có đặc điểm tương đồng với bộ phim mà người dùng đang theo dõi hoặc tìm kiếm.

\textbf{Chức năng thêm phim vào danh sách yêu thích}
\begin{figure}[H]
\centering
\includegraphics[width=1\linewidth]{Hinhve/ketqua3.png}
\caption{Chức năng thêm phim vào danh sách yêu thích}
\label{fig:ketqua3}
\end{figure} 

Người dùng có thể chủ động lưu lại những bộ phim yêu thích vào bộ sưu tập cá nhân thông qua tính năng thêm vào danh sách yêu thích khi tìm thấy nội dung phù hợp.

\textbf{Chức năng review phim}
\begin{figure}[H]
\centering
\includegraphics[width=1\linewidth]{Hinhve/ketqua4.png}
\caption{Chức năng review phim}
\label{fig:ketqua4}
\end{figure} 

Người dùng có thể truy cập vào trang chi tiết phim để xem các bình luận và đánh giá từ cộng đồng, đồng thời có thể tự mình viết đánh giá về bộ phim đó.

\textbf{Chức năng xem toàn bộ ảnh của phim}
\begin{figure}[H]
\centering
\includegraphics[width=1\linewidth]{Hinhve/ketqua5.png}
\caption{Chức năng xem toàn bộ ảnh của phim}
\label{fig:ketqua5}
\end{figure} 

Người dùng có thể truy cập vào trang chi tiết phim để xem toàn bộ danh sách hình ảnh liên quan đến bộ phim, các dữ liệu này được thu thập và tổng hợp từ các nguồn đáng tin cậy.

\section{Kiểm thử}

\FloatBarrier
\begin{table}[ht!]
\centering
\caption{Kiểm thử chức năng}
\includegraphics[width=1\linewidth]{Hinhve/test1.png}
\label{tab:test1}
\end{table} 
\FloatBarrier

\FloatBarrier
\begin{table}[ht!]
\centering
\caption{Kiểm thử chức năng}
\includegraphics[width=1\linewidth]{Hinhve/test2.png}
\label{tab:test2}
\end{table} 
\FloatBarrier

\begin{table}[H]
\centering
\caption{Bảng danh sách kiểm thử hiệu năng}
\label{tab:performance-test-list}
\begin{tabular}{|p{0.4\textwidth}|p{0.35\textwidth}|p{0.15\textwidth}|p{0.1\textwidth}|}
\hline
\textbf{Tên kiểm thử} & \textbf{Endpoint/Method} & \textbf{Yêu cầu} & \textbf{Mã} \\
\hline
GET Danh sách phim & GET /api/v1/movies/ & < 3s & TC01 \\
\hline
GET Chi tiết phim & POST /api/v1/movies/1/ & < 3s & TC02 \\
\hline
GET Lọc phim & GET /api/v1/movies/filter-options/ & < 3s & TC03 \\
\hline
GET Metadata phim & GET /api/v1/movies/1/cast/ & < 3s & TC04 \\
\hline
POST Đăng ký & POST /api/v1/users/register/ & < 3s & TC05 \\
\hline
POST Đăng nhập & POST /api/v1/users/login/ & < 3s & TC06 \\
\hline
Tìm kiếm AI (Mock) & POST /api/v1/movies/search/natural/ & < 10s & TC07 \\
\hline
Gợi ý AI (Mock) & GET /api/v1/movies/recommend/realtime/perf\_test\_user/ & < 10s & TC08 \\
\hline
Định dạng response nhất quán & GET /api/v1/movies/ & Có & TC09 \\
\hline
Thông báo lỗi rõ ràng & POST /api/v1/movies/999999/ & Có & TC10 \\
\hline
Validation đầu vào & POST /api/v1/users/login/ & Có & TC11 \\
\hline
Documentation trong code & Code structure & Có & TC12 \\
\hline
Tổ chức code theo modules & Code organization & Có & TC13 \\
\hline
Nhất quán RESTful API & Multiple endpoints & Có & TC14 \\
\hline
Kết nối database & Database connection & < 1s & TC15 \\
\hline
Hiệu năng query cơ bản & SELECT query & < 1s & TC16 \\
\hline
Tính toàn vẹn dữ liệu & Data integrity & Có & TC17 \\
\hline
Xử lý transaction & Transaction & Có & TC18 \\
\hline
\end{tabular}
\end{table}

\begin{table}[H]
\centering
\caption{Bảng kết quả kiểm thử hiệu năng}
\label{tab:performance-test-results}
\begin{tabular}{|p{0.12\textwidth}|p{0.12\textwidth}|p{0.18\textwidth}|p{0.12\textwidth}|p{0.12\textwidth}|p{0.24\textwidth}|}
\hline
\textbf{Mã} & \textbf{Yêu cầu} & \textbf{Thời gian thực tế (s)} & \textbf{Status Code} & \textbf{Kết quả} \\
\hline
TC01 & < 3s & 0.009 & 200 & Đạt \\
\hline
TC02 & < 3s & 0.004 & 200 & Đạt \\
\hline
TC03 & < 3s & 0.099 & 200 & Đạt \\
\hline
TC04 & < 3s & 0.007 & 200 & Đạt \\
\hline
TC05 & < 3s & 0.001 & 400 & Đạt \\
\hline
TC06 & < 3s & 0.184 & 200 & Đạt \\
\hline
TC07 & < 10s & 4.6 & 200 & Đạt \\
\hline
TC08 & < 10s & 2.9 & 200 & Đạt \\
\hline
TC09 & Có & 0.000 & 200 & Đạt \\
\hline
TC10 & Có & 0.000 & 404 & Đạt \\
\hline
TC11 & Có & 0.000 & 400 & Đạt \\
\hline
TC12 & Có & 0.000 & 200 & Đạt \\
\hline
TC13 & Có & 0.000 & 200 & Đạt \\
\hline
TC14 & Có & 0.000 & 200 & Đạt \\
\hline
TC15 & < 1s & 0.000 & 200 & Đạt \\
\hline
TC16 & < 1s & 0.005 & 200 & Đạt \\
\hline
TC17 & Có & 0.000 & 200 & Đạt \\
\hline
TC18 & Có & 0.000 & 200 & Đạt \\
\hline
\end{tabular}
\end{table}
    

Thông qua các bước kiểm thử đã được trình bày ở trên (\autoref{tab:test1}, \autoref{tab:test2}, \autoref{tab:performance-test-list}, \autoref{tab:performance-test-results}), có thể nhận thấy rằng hệ thống đã được kiểm thử thành công và sẵn sàng để đưa vào vận hành khi tất cả các test case đều đạt yêu cầu và hoạt động ổn định.

\section{Triển khai}
\textbf{Mô hình triển khai}
Hệ thống được vận hành theo kiến trúc client-server, với giao diện người dùng (frontend) được khởi chạy trên live server và bộ phận xử lý trung tâm (backend) được thiết lập thông qua Django trên máy trạm cá nhân.

\textbf{Thông số thiết lập}: Máy tính cá nhân đáp ứng các tiêu chuẩn sau:

Hệ điều hành: Tương thích Windows, Linux hoặc MacOS

Bộ vi xử lý: Tối thiểu Intel i3 hoặc các dòng CPU có hiệu năng tương đương

Bộ nhớ trong (RAM): 4GB

Lưu trữ: Ổ cứng SSD dung lượng 128GB

Yêu cầu đường truyền: Kết nối Internet ổn định ở mức băng thông trung bình

\textbf{Triển khai}

Thực hiện clone repository từ GitHub về máy tính cá nhân.

Tiến hành cài đặt Docker vào máy tính.

Di chuyển vào thư mục dự án và thực thi lệnh docker-compose up -d để khởi chạy hệ thống. Sau khi hoàn thành, toàn bộ hệ thống đã được vận hành trên máy tính cá nhân. Truy cập vào cổng localhost:3000 để kiểm thử hệ thống.

\textbf{Đánh giá kết quả vận hành thực nghiệm}

Dù quá trình thử nghiệm hiện mới chỉ dừng lại ở phạm vi môi trường nội bộ (local), các chỉ số ghi nhận được cho thấy những tín hiệu khả quan:

Hiệu suất xử lý: Trong điều kiện vận hành nội bộ, dù chưa có dữ liệu đánh giá áp lực tải ở quy mô lớn, hệ thống vẫn duy trì được sự ổn định tuyệt vời với lưu lượng truy cập thử nghiệm thấp, không xảy ra hiện tượng nghẽn mạng hay suy giảm hiệu năng.

Tốc độ phản hồi: Hệ thống ghi nhận độ trễ trung bình dưới 2 giây cho các thao tác thông thường. Riêng các tác vụ phức tạp hơn như thuật toán gợi ý phim đạt tốc độ dưới 5 giây và chức năng truy vấn tìm kiếm phim hoàn tất trong khoảng dưới 10 giây.

Đánh giá từ người dùng: Nhóm tham gia thử nghiệm có những phản hồi rất tốt về tính tinh gọn, dễ tiếp cận của giao diện cũng như độ chính xác của công cụ tìm kiếm. Đáng chú ý, các kết quả từ hệ thống đề xuất và tìm kiếm đều bám sát và thỏa mãn đúng kỳ vọng của người trải nghiệm.

Việc chạy thử nghiệm trên môi trường local đã giúp xác thực thành công các tính năng nền tảng và nhận về những tương tác tích cực từ phía người dùng. Các số liệu cho thấy một hệ thống hoạt động tin cậy, tốc độ xử lý nhanh cùng giao diện tối ưu. Tuy nhiên, để có cái nhìn chuyên sâu hơn về ngưỡng chịu tải và hiệu năng thực tế, việc đưa hệ thống lên các máy chủ chuyên dụng là bước đi cần thiết tiếp theo.

\end{document}
